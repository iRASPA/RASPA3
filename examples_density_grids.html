<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RASPA3: Examples Density Grids</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">RASPA3<span id="projectnumber">&#160;3.0.21</span>
   </div>
   <div id="projectbrief">A molecular simulation code for computing adsorption and diffusion in nanoporous materials</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('examples_density_grids.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Examples Density Grids</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This section illustrates advanced density grid features in RASPA3, including site-resolved probability plots, equitable binning, and their combined use for analyzing adsorption behaviour and identifying binding regions.</p>
<h1>Table of Contents</h1>
<ol type="1">
<li><a class="el" href="examples_density_grids.html#Example_density_1">Binary mixture and site-resolved density grids</a> <br  />
 <code>1_mc_adsorption_binary_mixture_co2_ch4_in_irmof_1_split_density_by_site</code></li>
<li><a class="el" href="examples_density_grids.html#Example_density_2">Effect of equitable binning on density grids</a> <br  />
 <code>2_mc_adsorption_of_methane_in_mfi_standard_binning</code> <code>3_mc_adsorption_of_methane_in_mfi_equitable_binning</code></li>
<li><a class="el" href="examples_density_grids.html#Example_density_3">Combined use: site-resolved grids, equitable binning, and binding site analysis</a> <br  />
 <code>4_mc_adsorption_of_co2_in_calf_20_methyl_split_density_equitable_binning</code> <code>5_mc_adsorption_of_c2h2_in_cpl_1_split_density_equitable_binning</code> <code>6_mc_adsorption_of_co2_in_calf_20_split_density_equitable_binning</code></li>
</ol>
<hr  />
<h3>Binary mixture and site-resolved density grids <a class="anchor" id="Example_density_1"></a></h3>
<p>This example demonstrates the generation of site-resolved density grids for a binary mixture of CO<sub>2</sub> and CH<sub>4</sub> adsorbed in IRMOF-1. By restricting the density grid calculation to selected pseudo atom types, separate probability plots are written for each interaction site. This allows adsorption behaviour to be resolved at the atomic level in multi-component systems. In this example, density grids are generated only for the pseudo atoms associated with CO<sub>2</sub>. If density grids for CH<sub>4</sub> interaction sites are also of interest, the corresponding pseudo atom name can be added to the <code>"DensityGridPseudoAtomsList"</code> to generate those probability plots as well.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;SimulationType&quot; : &quot;MonteCarlo&quot;,</div>
<div class="line">  &quot;NumberOfCycles&quot; : 1000000,</div>
<div class="line">  &quot;NumberOfInitializationCycles&quot; : 100000,</div>
<div class="line">  &quot;PrintEvery&quot; : 10000,</div>
<div class="line">  </div>
<div class="line">  &quot;Systems&quot; : [</div>
<div class="line">    {</div>
<div class="line">      &quot;Type&quot; : &quot;Framework&quot;,</div>
<div class="line">      &quot;Name&quot; : &quot;IRMOF-1&quot;,</div>
<div class="line">      &quot;NumberOfUnitCells&quot; : [1, 1, 1],</div>
<div class="line">      &quot;HeliumVoidFraction&quot; : 0.81,</div>
<div class="line">      &quot;ChargeMethod&quot; : &quot;Ewald&quot;,</div>
<div class="line">      &quot;ExternalTemperature&quot; : 300.0,</div>
<div class="line">      &quot;ExternalPressure&quot; : 1e6,</div>
<div class="line">      &quot;ComputeDensityGrid&quot; : true,</div>
<div class="line">      &quot;SampleDensityGridEvery&quot; : 10,</div>
<div class="line">      &quot;WriteDensityGridEvery&quot; : 10000,</div>
<div class="line">      &quot;DensityGridSize&quot; : [128, 128, 128],</div>
<div class="line">      &quot;DensityGridPseudoAtomsList&quot; : [&quot;C_co2&quot;, &quot;O_co2&quot;]</div>
<div class="line">    }</div>
<div class="line">  ],</div>
<div class="line"> </div>
<div class="line">  &quot;Components&quot; : [ </div>
<div class="line">    {</div>
<div class="line">      &quot;Name&quot; : &quot;CO2&quot;,</div>
<div class="line">      &quot;MolFraction&quot; : 0.25,</div>
<div class="line">      &quot;IdealGasRosenbluthWeight&quot; : 1.0,</div>
<div class="line">      &quot;TranslationProbability&quot; : 0.5,</div>
<div class="line">      &quot;RotationProbability&quot; : 0.5,</div>
<div class="line">      &quot;ReinsertionProbability&quot; : 0.5,</div>
<div class="line">      &quot;SwapProbability&quot; : 1.0,</div>
<div class="line">      &quot;WidomProbability&quot; : 1.0,</div>
<div class="line">      &quot;CreateNumberOfMolecules&quot; : 0</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">      &quot;Name&quot; : &quot;methane&quot;,</div>
<div class="line">      &quot;MolFraction&quot; : 0.75,</div>
<div class="line">      &quot;IdealGasRosenbluthWeight&quot; : 1.0,</div>
<div class="line">      &quot;TranslationProbability&quot; : 0.5,</div>
<div class="line">      &quot;RotationProbability&quot; : 0.5,</div>
<div class="line">      &quot;ReinsertionProbability&quot; : 0.5,</div>
<div class="line">      &quot;SwapProbability&quot; : 1.0,</div>
<div class="line">      &quot;WidomProbability&quot; : 1.0,</div>
<div class="line">      &quot;CreateNumberOfMolecules&quot; : 0</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>Separate density grid files are written for each specified pseudo atom type and stored in the <code>density_grids</code> directory.</p>
<div class="fragment"><div class="line">./</div>
<div class="line">└── density_grids</div>
<div class="line">    ├── grid_cell_component_CO2_C_co2.s0.cube</div>
<div class="line">    ├── grid_cell_component_CO2_O_co2.s0.cube</div>
<div class="line">    ├── grid_unitcell_component_CO2_C_co2.s0.cube</div>
<div class="line">    └── grid_unitcell_component_CO2_O_co2.s0.cube</div>
</div><!-- fragment --><hr  />
<h3>Effect of equitable binning on density grids <a class="anchor" id="Example_density_2"></a></h3>
<p>The following examples compare conventional histogram binning with equitable binning for methane adsorption in the MFI framework. Both simulations use identical settings except for the binning strategy.</p>
<p><b>Standard binning</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;DensityGridBinning&quot; : &quot;Standard&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Equitable binning</b> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;DensityGridBinning&quot; : &quot;Equitable&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>With equitable binning, each guest site contributes fractionally to neighbouring voxels based on its position, reducing discretization artefacts and producing smoother probability distributions. Neither standard nor equitable binning is inherently superior, and for well converged simulations the resulting local maxima are expected to be very similar. The figure below compares the two binning schemes at a representative isovalue, highlighting the primarily visual nature of the differences.</p>
<div class="image">
<img src="standard_vs_equitable.png" alt=""/>
</div>
<hr  />
<h3>Combined use: site-resolved grids, equitable binning, and binding site analysis <a class="anchor" id="Example_density_3"></a></h3>
<p>This section demonstrates the combined use of site-resolved density grids and equitable binning for chemically complex systems. Examples include CO<sub>2</sub> adsorption in CALF-20 (with and without methyl functionalization) and C<sub>2</sub>H<sub>2</sub> adsorption in CPL-1.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;ComputeDensityGrid&quot; : true,</div>
<div class="line">  &quot;DensityGridBinning&quot; : &quot;Equitable&quot;,</div>
<div class="line">  &quot;DensityGridPseudoAtomsList&quot; : [&quot;C_x&quot;, &quot;H_x&quot;]</div>
<div class="line">}</div>
</div><!-- fragment --><p>The resulting density grids provide smooth, atom-specific probability distributions that highlight preferred adsorption regions within the frameworks.</p>
<p>Such probability plots can be further analyzed using external post-processing tools to identify high-probability regions and extract representative binding site configurations. The figures shown here were generated using external analysis routines to extract and fit binding site geometries directly from adsorbate probability distributions (APD) such as the RASPA-generated density grids. In these visualizations, the probability density highlights regions where a guest molecule is most likely to reside within the framework. For example, in the CPL-1 case, individual atomic contributions are resolved, with different colours used to represent distinct atom types within the guest molecule (e.g., carbon and hydrogen), providing an intuitive picture of both molecular orientation and preferred adsorption sites. The grid resolutions used for these examples were selected to correspond to a real-space grid spacing of 0.15 Å, and the supercell sizes were determined by the van der Waals cutoff. As a result, the displayed grids differ from the default [128, 128, 128] resolution and also differ between systems. These workflows operate independently of the simulation itself.</p>
<div class="image">
<img src="cpl-1.png" alt=""/>
</div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="md_docs_2manual.html">User Manual</a></li><li class="navelem"><a class="el" href="examples.html">Examples</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
